function SlideFactory(){this.create=function(index,data,app){var x=function(index,app){return 0==index?app.renderer.width/2:app.renderer.width}(index,app),y=function(app){return.35*app.renderer.height}(app),textObj=function(x,text,app){return{x:x,y:.85*app.renderer.height,txt:text,size:35}}(x,data.text,app),links=function(data){for(var linkList=[],i=0;i<data.length;i++)linkList.push({id:i,x:data[i].position.x,y:data[i].position.y,text:data[i].text});return linkList}(data.interactive.links);return new SlideView(index,x,y,data.imageName,data.imageUrl,textObj,links,data,app)}}var LoaderHelper=function(){function loadFonts(){window.WebFontConfig={google:{families:["Snippet","Arvo:700italic","Podkova:700"]},active:function(){loadAssets()}}}function loadAssets(){PIXI.loader.add("assets/data/imageData.json").add("assets/images/arrow.png").add("assets/images/leftArrow.png").add("assets/images/rightArrow.png").add("assets/images/cat1.jpg").add("assets/images/cat2.jpg").add("assets/images/box.png").add("assets/images/popUpBox.png").load(loadCB)}function setLoadCallback(onLoadCallback){loadCB=onLoadCallback}var loadCB;return{load:function(onLoadCallback){setLoadCallback(onLoadCallback),loadFonts()}}}(),slideApp=function(){function init(){function load(){LoaderHelper.load(onLoaded)}function onLoaded(){console.log("onLoaded"),app=new PIXI.Application({width:800,height:600,resolution:1,antialias:!0,forceCanvas:!0,backgroundColor:7197807}),document.body.appendChild(app.view),console.log("app",app),createControllers(),setupNotifier(),createSlideShow(),requestAnimationFrame(animate)}function createControllers(){(slideShowController=new SlideShowController).init(app),(navigatorController=new NavigatorController).init(app)}function setupNotifier(){(notifier=new NotifyHelper).register(slideShowController),notifier.register(slideShowController.slideShowView),notifier.register(navigatorController),notifier.register(navigatorController.navigatorView)}function createSlideShow(){slideShowController.createSlideShow()}function animate(){app.renderer.render(app.stage),requestAnimationFrame(animate)}return{start:function(){load()}}}var instance,app,slideShowController,navigatorController,notifier;return{getInstance:function(){return instance||(instance=init()),instance}}}(),NotifyHelper=function(){var handlers={};return{register:function(handler){handlers[handler.name]=handler,handler.notifyHelper=this},notify:function(receiver){handlers[receiver];receiver.onClick()},sendClickEvent:function(receiver,mssg){console.log("navigator helper send click events");for(key in handlers)handlers[key].name===receiver&&handlers[key].onClick(mssg)}}},InteractiveBoxHelper=function(){function create(boxArray,parent){for(var boxList=[],i=0;i<boxArray.length;i++)boxList.push(new RoundedBox(boxArray[i],parent,16767743));return boxList}function updateBoxPosition(offsetX,boxArray,parent){for(var i=0;i<boxArray.length;i++)boxArray[i].updateBoxPosition(offsetX,parent)}return{getBoxes:function(boxArray,parent){return boxArray&&0!=boxArray.length?create(boxArray,parent):null},update:function(offsetX,boxArray,parent){updateBoxPosition(offsetX,boxArray,parent)}}},SlideShowController=function(){this.name="slideShowController",this.app=null,this.slideModel=null,this.slideShowView=null,this.slides=[],this.notifyHelper=null,this.slideFactory=new SlideFactory};SlideShowController.prototype.init=function(app){this.app=app,this.slideModel=new SlideShowModel,this.slideModel.init(app),this.slideShowView=new SlideShowView,this.slideShowView.init(app)},SlideShowController.prototype.createSlideShow=function(){for(var data=this.slideModel.getData(),i=0;i<data.slides.length;i++){var slide=this.slideFactory.create(i,data.slides[i],this.app);this.slides.push(slide)}console.log(this.slides),this.setCurrentSlide(0),this.show()},SlideShowController.prototype.getCurrentSlide=function(){return this.currentSlide},SlideShowController.prototype.setCurrentSlide=function(index){this.currentSlide=this.slides[index],this.slideShowView.setCurrentSlide(this.currentSlide)},SlideShowController.prototype.show=function(){this.slideShowView.show()},SlideShowController.prototype.onClick=function(data){console.log("Slide show Click"),console.log("=========================="),this.slideShowView.update(),console.log(this.slideModel.getCurrentSlide()),console.log(this.slideModel.getPreviousSlide()),console.log(this.slideModel.getNextSlide())};var NavigatorController=function(){this.name="navigatorController",this.navigatorView=null,this.leftArrow=null,this.rightArrow=null,this.app=null,this.notifyHelper=null};NavigatorController.prototype.init=function(app){this.app=app,this.createGUI(),this.navigatorView=new NavigatorView,this.navigatorView.init(this.leftArrow,this.rightArrow,this.app)},NavigatorController.prototype.createGUI=function(){this.leftArrow=new Arrow("assets/images/leftArrow.png",this.app,"left"),this.rightArrow=new Arrow("assets/images/rightArrow.png",this.app,"right"),this.app.stage.addChild(this.leftArrow),this.app.stage.addChild(this.rightArrow)},NavigatorController.prototype.onClick=function(mssg){console.log("NavigatorController Click"),this.notifyHelper.sendClickEvent("slideShowController",mssg)};var BackendSlideHelper=function(){function getCurrentSlide(index){return lastIndex=slides.length-1,index<0?slides[lastIndex]:0===index?slides[0]:index>lastIndex?slides[0]:slides[index]}function getPreviousSlide(index){lastIndex=slides.length-1;var currentIndex=index-1;return currentIndex<0?slides[lastIndex-1]:slides[currentIndex]}function getNextSlide(index){var currentIndex=index+1;return currentIndex>=(lastIndex=slides.length-1)?(console.log("getNextSlide, >",currentIndex,lastIndex,index),slides[0]):currentIndex<0?slides[lastIndex-2]:(console.log("getNextSlide"),slides[currentIndex])}var slides=[],lastIndex=0;return{getCurrent:function(index){return console.log("currentSlide",index,getCurrentSlide(index).id),getCurrentSlide(index)},getPrevious:function(index){return console.log("getPreviousSlide",index,getPreviousSlide(index).id),getPreviousSlide(index)},getNext:function(index){return console.log("getNext",index,getNextSlide(index).id),getNextSlide(index)}}},SlideShowModel=function(){this.app=null,this.slideHelper=new BackendSlideHelper,this.slideShowList=[],this.previousSlide=null,this.currentSlide=null,this.nextSlide=null,this.slideData=null};SlideShowModel.prototype.init=function(app){this.app=app,this.slideData=PIXI.loader.resources["assets/data/imageData.json"].data},SlideShowModel.prototype.getData=function(){return this.slideData},SlideShowModel.prototype.setNavigatorPositions=function(index){this.currentSlide=this.slideHelper.getCurrent(index),this.previousSlide=this.slideHelper.getPrevious(index),this.nextSlide=this.slideHelper.getNext(index)},SlideShowModel.prototype.getCenterPositionX=function(){return this.app.renderer.width},SlideShowModel.prototype.getOffsetPositionX=function(data){return"left"==data?-this.app.renderer.width:this.app.renderer.width},SlideShowModel.prototype.getCurrentIndex=function(data){return"left"==data?this.currentSlide.id-1:this.currentSlide.id+1},SlideShowModel.prototype.getCurrentSlide=function(){return this.currentSlide},SlideShowModel.prototype.getPreviousSlide=function(){return this.previousSlide},SlideShowModel.prototype.getNextSlide=function(){return this.nextSlide};var SlideShowView=function(app){this.app=app,this.slides=[],this.name="slideShowView",this.notifyHelper=null,this.slide=null,this.currentSlide=null};SlideShowView.prototype.init=function(app){this.app=app},SlideShowView.prototype.setCurrentSlide=function(slide){this.currentSlide=slide},SlideShowView.prototype.show=function(){this.currentSlide.toggleVisibility(!0)},SlideShowView.prototype.toggleVisibility=function(index,value){this.slides[index].toggleVisibility(value)},SlideShowView.prototype.update=function(offsetX,currentX,currentSlide){TweenLite.to(this.currentSlide.slideImage,.35,{x:-400})};var NavigatorView=function(){this.leftArrow=null,this.rightArrow=null,this.name="navigatorView",this.app=null,this.notifyHelper=null};NavigatorView.prototype.init=function(leftArrow,rightArrow,app){this.app=app,this.leftArrow=leftArrow,this.rightArrow=rightArrow,this.leftArrow.setupClickListeners(this.onClick,this),this.rightArrow.setupClickListeners(this.onClick,this)},NavigatorView.prototype.onClick=function(dir){console.log("NavigatorView Click"),this.notifyHelper.sendClickEvent("navigatorController",dir)};var PopupBox=function(text){this.name="popUpBox",this.popUpImage=new PopUpImage,this.popUpText=new PopUpText,this.notifyHelper=null,this.visible=!1};PopupBox.prototype.toggleVisibility=function(value){this.popUpImage.visible=value,this.popUpText.visible=value},PopupBox.prototype.onClick=function(parent){this.visible=!this.visible,this.visible?this.show(parent):this.hide()},PopupBox.prototype.show=function(parent){this.toggleVisibility(!0),this.popUpImage.updateImage(parent),this.popUpText.updateTextInfo(parent.text,this.popUpImage)},PopupBox.prototype.hide=function(){this.toggleVisibility(!1)};var PopUpText=function(){PIXI.Text.call(this,"This is filler text",{fontFamily:"Snippet",fontSize:15,fill:"black",align:"center"}),this.x=10,this.y=10,this.anchor.set(.5,.5),this.visible=!1};PopUpText.prototype=Object.create(PIXI.Text.prototype),PopUpText.prototype.constructor=PopUpText,PopUpText.prototype.updateTextInfo=function(txt,parent){this.x=parent.x,this.y=parent.y,this.text=txt,console.log("text",this,parent)};var PopUpImage=function(){PIXI.Sprite.call(this,PIXI.Texture.fromImage("assets/images/popUpBox.png")),this.position.x=10,this.position.y=10,this.width=200,this.height=100,this.anchor.set(.5),this.visible=!1};PopUpImage.prototype=Object.create(PIXI.Sprite.prototype),PopUpImage.prototype.constructor=PopUpImage,PopUpImage.prototype.updateImage=function(parent){this.position.x=parent.x+1.5*parent.width,this.position.y=parent.y-1.5*parent.height};var RoundedBox=function(obj,parent,tint){PIXI.Sprite.call(this,PIXI.Texture.fromImage("assets/images/box.png"));var offsetX=parent.x-parent.width*parent.anchor.x+obj.x,offsetY=parent.y-parent.height*parent.anchor.y+obj.y;this.position.x=offsetX,this.position.y=offsetY,this.name="roundedBox",this.tint=tint,this.scale.set(.5),this.text=obj.text,this.notifyHelper=null,this.visible=!1,this.setupClickListeners()};RoundedBox.prototype=Object.create(PIXI.Sprite.prototype),RoundedBox.prototype.constructor=RoundedBox,RoundedBox.prototype.setupClickListeners=function(){this.buttonMode=!0,this.interactive=!0;var that=this;this.on("pointerdown",function(){that.notifyHelper.sendClickEvent("popUpBox",that)}).on("pointerout",function(){console.log("out")})},RoundedBox.prototype.updateBoxPosition=function(offsetX,parent){var newOffsetX=parent.x-parent.width*parent.anchor.x+offsetX;this.position.x=newOffsetX};var SlideImage=function(x,y,imageUrl){PIXI.Sprite.call(this,PIXI.Texture.fromImage(imageUrl)),this.position.x=x,this.position.y=y,console.log("this.position.y",this.position.y),this.anchor.set(.5,.5),this.scale.set(.7),this.visible=!1};SlideImage.prototype=Object.create(PIXI.Sprite.prototype),SlideImage.prototype.constructor=SlideImage,SlideImage.prototype.hide=function(offsetX){this.position.x=offsetX,this.visible=!1},SlideImage.prototype.show=function(x){this.position.x=x,this.visible=!0};var SlideText=function(txtObj){PIXI.Text.call(this,txtObj.txt,{fontFamily:"Snippet",fontSize:txtObj.size,fill:"black",align:"center"}),this.x=txtObj.x,this.y=txtObj.y,this.anchor.set(.5,.5),this.visible=!1};SlideText.prototype=Object.create(PIXI.Text.prototype),SlideText.prototype.constructor=SlideText,SlideText.prototype.hide=function(offsetX){this.position.x=offsetX,this.visible=!1},SlideText.prototype.show=function(x){this.position.x=x,this.visible=!0};var Arrow=function(imageUrl,app,dir){PIXI.Sprite.call(this,PIXI.Texture.fromImage(imageUrl)),this.dir=dir,"left"===this.dir?this.position.x=.2*app.renderer.width:this.position.x=.8*app.renderer.width,this.position.y=.85*app.renderer.height,this.anchor.set(.5,.5),this.scale.set(.3)};Arrow.prototype=Object.create(PIXI.Sprite.prototype),Arrow.prototype.constructor=Arrow,Arrow.prototype.setupClickListeners=function(onClickCallback,onClickContext){this.buttonMode=!0,this.interactive=!0;var that=this;this.on("pointerdown",function(){onClickCallback.call(onClickContext,that.dir)}).on("pointerout",function(){console.log("out")})};var SlideView=function(index,x,y,name,imageUrl,textObj,links,data,app){this.id=index,this.slideText=new SlideText(textObj),this.slideImage=new SlideImage(x,y,imageUrl),this.interactiveBoxHelper=new InteractiveBoxHelper,this.interactiveBoxes=this.interactiveBoxHelper.getBoxes(links,this.slideImage),this.popUpBox=new PopupBox,app.stage.addChild(this.slideText),app.stage.addChild(this.slideImage),app.stage.addChild(this.popUpBox.popUpImage),app.stage.addChild(this.popUpBox.popUpText);for(var i=0;i<this.interactiveBoxes.length;i++)app.stage.addChild(this.interactiveBoxes[i]);this.setupNotifier(),console.log("obj",data)};SlideView.prototype.setupNotifier=function(){this.notifier=new NotifyHelper,this.notifier.register(this.popUpBox);for(var i=0;i<this.interactiveBoxes.length;i++)this.notifier.register(this.interactiveBoxes[i])},SlideView.prototype.toggleVisibility=function(value){this.slideText.visible=value,this.slideImage.visible=value;for(var i=0;i<this.interactiveBoxes.length;i++)this.interactiveBoxes[i].visible=value},SlideView.prototype.hide=function(offsetX){this.slideImage.hide(offsetX),this.slideText.hide(offsetX),this.interactiveBoxHelper.update(offsetX,this.interactiveBoxes,this.slideImage)},SlideView.prototype.show=function(x){this.slideImage.show(x),this.slideText.show(x),this.interactiveBoxHelper.update(x,this.interactiveBoxes,this.slideImage)};