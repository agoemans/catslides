function BackEndLink(obj,index){this.id=index,this.x=obj.position.x,this.y=obj.position.y,this.text=obj.text}function BackEndSlide(obj,index,app){this.backendLinkHelper=new BackendLinkHelper,this.id=index,this.name=obj.imageName,this.url=obj.imageUrl,this.getPositionX=function(index,app){return 0==index?app.renderer.width/2:app.renderer.width},this.getPositionY=function(app){return.35*app.renderer.height},this.getTextObj=function(text,app){return{x:app.renderer.width/2,y:.85*app.renderer.height,txt:text,size:35}},this.x=this.getPositionX(index,app),this.y=this.getPositionY(app),this.w=obj.size.w,this.h=obj.size.h,this.txtObj=this.getTextObj(obj.text,app),this.lNum=obj.interactive.numOfLinks,this.links=this.backendLinkHelper.getLinks(obj),this.visible=!1}var LoaderHelper=function(){function loadFonts(){window.WebFontConfig={google:{families:["Snippet","Arvo:700italic","Podkova:700"]},active:function(){loadAssets()}}}function loadAssets(){PIXI.loader.add("assets/data/imageData.json").add("assets/images/arrow.png").add("assets/images/leftArrow.png").add("assets/images/rightArrow.png").add("assets/images/cat1.jpg").add("assets/images/cat2.jpg").add("assets/images/box.png").add("assets/images/popUpBox.png").load(loadCB)}function setLoadCallback(onLoadCallback){loadCB=onLoadCallback}var loadCB;return{load:function(onLoadCallback){setLoadCallback(onLoadCallback),loadFonts()}}}(),slideApp=function(){function init(){function load(){LoaderHelper.load(onLoaded)}function onLoaded(){console.log("onLoaded"),app=new PIXI.Application({width:800,height:600,resolution:1,antialias:!0,forceCanvas:!0,backgroundColor:7197807}),document.body.appendChild(app.view),console.log("app",app),createControllers(),setupNotifier(),createSlideShow(),requestAnimationFrame(animate)}function createControllers(){(slideShowController=new SlideShowController).init(app),(navigatorController=new NavigatorController).init(app)}function setupNotifier(){(notifier=new NotifyHelper).register(slideShowController),notifier.register(slideShowController.slideView),notifier.register(navigatorController),notifier.register(navigatorController.navigatorView)}function createSlideShow(){slideShowController.createSlideShow()}function animate(){app.renderer.render(app.stage),requestAnimationFrame(animate)}return{start:function(){load()}}}var instance,app,slideShowController,navigatorController,notifier;return{getInstance:function(){return instance||(instance=init()),instance}}}(),NotifyHelper=function(){var handlers={};return{register:function(handler){handlers[handler.name]=handler,handler.notifyHelper=this},notify:function(receiver){handlers[receiver];receiver.onClick()},sendClickEvent:function(receiver){console.log("navigator helper send click events");for(key in handlers)handlers[key].name===receiver&&handlers[key].onClick()}}},InteractiveBoxHelper=function(){function create(boxArray,parent){for(var boxList=[],i=0;i<boxArray.length;i++)boxList.push(new RoundedBox(boxArray[i],parent,16767743));return boxList}return{getBoxes:function(obj,parent){return null===obj.links?null:create(obj.links,parent)}}},SlideShowController=function(){this.slideModel=null,this.slideView=null,this.name="slideShowController",this.app=null,this.notifyHelper=null,this.currentSlide=null};SlideShowController.prototype.init=function(app){this.app=app,this.slideModel=new SlideShowModel,this.slideModel.init(app),this.slideView=new SlideShowView(this.app)},SlideShowController.prototype.createSlideShow=function(){this.slideView.createSlideShow(this.slideModel.getSlideList()),this.slideView.toggleVisibility(0,!0),this.currentSlide=this.slideModel.getCurrentSlide()},SlideShowController.prototype.onClick=function(){console.log("Slide show Click"),this.slideView.setCurrentSlide(this.slideModel.getCurrentSlide())};var NavigatorController=function(){this.navigatorView=null,this.name="navigatorController",this.app=null,this.notifyHelper=null};NavigatorController.prototype.init=function(app){this.app=app,this.navigatorView=new NavigatorView,this.navigatorView.init(this.app)},NavigatorController.prototype.onClick=function(){console.log("NavigatorController Click"),this.notifyHelper.sendClickEvent("slideShowController")};var BackendLinkHelper=function(){function create(linkArray){for(var linkList=[],i=0;i<linkArray.length;i++)linkList.push(new BackEndLink(linkArray[i]),i);return linkList}return{getLinks:function(obj){return obj.interactive.clickable?create(obj.interactive.links):null}}},BackendSlideHelper=function(){function create(slideArray,app){for(var slideList=[],i=0;i<slideArray.length;i++)slideList.push(new BackEndSlide(slideArray[i],i,app));return slideList}function updateSlidePosition(){}return{getSlides:function(slideArray,app){return create(slideArray,app)},setPosition:function(index){updateSlidePosition()}}},SlideShowModel=function(){this.app=null,this.slideHelper=new BackendSlideHelper,this.slideShowList=[],this.previousSlide=null,this.currentSlide=null,this.nextSlide=null,this.slideData=null};SlideShowModel.prototype.init=function(app){this.app=app,this.slideData=PIXI.loader.resources["assets/data/imageData.json"].data,this.slideShowList=this.slideHelper.getSlides(this.slideData.slides,this.app),this.setSlidePositions(0)},SlideShowModel.prototype.getSlideList=function(){return this.slideShowList},SlideShowModel.prototype.setSlidePositions=function(currentIndex){var lastIndex=this.slideShowList.length-1;this.currentSlide=this.slideShowList[currentIndex],this.previousSlide=0===currentIndex?this.slideShowList[lastIndex]:this.slideShowList[currentIndex-1],currentIndex===lastIndex?this.nextSlide=this.slideShowList[0]:this.previousSlide=this.slideShowList[currentIndex+1]},SlideShowModel.prototype.updateSlidePosition=function(){},SlideShowModel.prototype.getCurrentSlide=function(){return this.currentSlide};var SlideShowView=function(app){this.app=app,this.slides=[],this.name="slideShowView",this.notifyHelper=null,this.slide=null,this.currentSlide=null};SlideShowView.prototype.createSlideShow=function(slideArray){this.setSlides(slideArray)},SlideShowView.prototype.setSlides=function(slideArray){for(var i=0;i<slideArray.length;i++){var slide=this.createSlide(slideArray[i]);this.slides.push(slide)}console.log("view createSlideShow",this.slides,this.app)},SlideShowView.prototype.createSlide=function(slideObj){this.slide=new Slide(slideObj),this.app.stage.addChild(this.slide.slideText),this.app.stage.addChild(this.slide.slideImage),this.app.stage.addChild(this.slide.popUpBox.popUpImage),this.app.stage.addChild(this.slide.popUpBox.popUpText);for(var i=0;i<this.slide.interactiveBoxes.length;i++)this.app.stage.addChild(this.slide.interactiveBoxes[i]);return this.slide},SlideShowView.prototype.toggleVisibility=function(index,value){this.slides[index].toggleVisibility(value)},SlideShowView.prototype.setCurrentSlide=function(slide){this.currentSlide=this.slides[slide.id]};var NavigatorView=function(){this.leftArrow=null,this.rightArrow=null,this.name="navigatorView",this.app=null,this.notifyHelper=null};NavigatorView.prototype.init=function(app){this.app=app,this.leftArrow=new Arrow("assets/images/leftArrow.png",app,!0),this.rightArrow=new Arrow("assets/images/rightArrow.png",app,!1),this.app.stage.addChild(this.leftArrow),this.app.stage.addChild(this.rightArrow),this.setupListeners()},NavigatorView.prototype.setupListeners=function(){this.leftArrow.buttonMode=!0,this.leftArrow.interactive=!0,this.leftArrow.on("pointerdown",this.onClick,this).on("pointerout",function(){console.log("out")}),this.rightArrow.buttonMode=!0,this.rightArrow.interactive=!0,this.rightArrow.on("pointerdown",this.onClick,this).on("pointerout",function(){console.log("out")})},NavigatorView.prototype.onClick=function(){console.log("NavigatorView Click"),this.notifyHelper.sendClickEvent("navigatorController")};var PopupBox=function(text){this.name="popUpBox",this.popUpImage=new PopUpImage,this.popUpText=new PopUpText,this.visible=!1};PopupBox.prototype.toggleVisibility=function(value){this.popUpImage.visible=value,this.popUpText.visible=value},PopupBox.prototype.show=function(parent){this.toggleVisibility(!0),this.popUpImage.updateImage(parent),this.popUpText.updateTextInfo(parent.text,this.popUpImage)},PopupBox.prototype.hide=function(){this.toggleVisibility(!1)};var PopUpText=function(){PIXI.Text.call(this,"This is filler text",{fontFamily:"Snippet",fontSize:15,fill:"black",align:"center"}),this.x=10,this.y=10,this.anchor.set(.5,.5),this.visible=!1};PopUpText.prototype=Object.create(PIXI.Text.prototype),PopUpText.prototype.constructor=PopUpText,PopUpText.prototype.updateTextInfo=function(txt,parent){this.x=parent.x,this.y=parent.y,this.text=txt,console.log("text",this,parent)};var PopUpImage=function(){PIXI.Sprite.call(this,PIXI.Texture.fromImage("assets/images/popUpBox.png")),this.position.x=10,this.position.y=10,this.width=200,this.height=100,this.anchor.set(.5),this.visible=!1};PopUpImage.prototype=Object.create(PIXI.Sprite.prototype),PopUpImage.prototype.constructor=PopUpImage,PopUpImage.prototype.updateImage=function(parent){this.position.x=parent.x+1.5*parent.width,this.position.y=parent.y-1.5*parent.height};var RoundedBox=function(obj,parent,tint){PIXI.Sprite.call(this,PIXI.Texture.fromImage("assets/images/box.png"));var offsetX=parent.x-parent.width*parent.anchor.x+obj.x,offsetY=parent.y-parent.height*parent.anchor.y+obj.y;this.position.x=offsetX,this.position.y=offsetY,this.tint=tint,this.scale.set(.5),this.text=obj.text,this.clicked=!1,this.visible=!1};RoundedBox.prototype=Object.create(PIXI.Sprite.prototype),RoundedBox.prototype.constructor=RoundedBox,RoundedBox.prototype.setupClickListeners=function(onClickCallback,onClickContext){console.log("RoundedBox setupClick listners"),this.buttonMode=!0,this.interactive=!0,this.on("pointerdown",function(){onClickCallback.call(onClickContext,this)}).on("pointerout",function(){console.log("out")})};var SlideImage=function(obj){PIXI.Sprite.call(this,PIXI.Texture.fromImage(obj.url)),this.position.x=obj.x,this.position.y=obj.y,console.log("this.position.y",this.position.y),this.anchor.set(.5,.5),this.scale.set(.7),this.visible=obj.visible};SlideImage.prototype=Object.create(PIXI.Sprite.prototype),SlideImage.prototype.constructor=SlideImage;var SlideText=function(txtObj){PIXI.Text.call(this,txtObj.txt,{fontFamily:"Snippet",fontSize:txtObj.size,fill:"black",align:"center"}),this.x=txtObj.x,this.y=txtObj.y,this.anchor.set(.5,.5),this.visible=!1};SlideText.prototype=Object.create(PIXI.Text.prototype),SlideText.prototype.constructor=SlideText;var Arrow=function(imageUrl,app,isLeft){PIXI.Sprite.call(this,PIXI.Texture.fromImage(imageUrl)),this.position.x=isLeft?.2*app.renderer.width:.8*app.renderer.width,this.position.y=.85*app.renderer.height,this.anchor.set(.5,.5),this.scale.set(.3)};Arrow.prototype=Object.create(PIXI.Sprite.prototype),Arrow.prototype.constructor=Arrow;var Slide=function(obj){this.id=obj.id,this.slideText=new SlideText(obj.txtObj),this.slideImage=new SlideImage(obj),this.interactiveBoxHelper=new InteractiveBoxHelper,this.interactiveBoxes=this.interactiveBoxHelper.getBoxes(obj,this.slideImage),this.popUpBox=new PopupBox,this.setupClickListeners(),console.log("obj",obj)};Slide.prototype.setupClickListeners=function(){for(var i=0;i<this.interactiveBoxes.length;i++)this.interactiveBoxes[i].setupClickListeners(this.onBoxClick,this)},Slide.prototype.onBoxClick=function(parent){console.log("receive click",parent),this.popUpBox.visible=!this.popUpBox.visible,this.popUpBox.visible?this.popUpBox.show(parent):this.popUpBox.hide()},Slide.prototype.toggleVisibility=function(value){this.slideText.visible=value,this.slideImage.visible=value;for(var i=0;i<this.interactiveBoxes.length;i++)this.interactiveBoxes[i].visible=value};